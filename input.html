<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</title>
  <style>
    body { direction: rtl; font-family: Arial; padding: 20px; background: #f0f0f0; }
    label, input, textarea { display: block; margin: 10px 0; width: 100%; max-width: 400px; }
    button { padding: 10px 20px; font-size: 16px; margin-top: 10px; cursor: pointer; }
    #scanner-container { margin-top: 15px; width: 100%; max-width: 400px; }
    .nav-button { background-color: #4CAF50; color: white; border: none; }
    .nav-button:hover { background-color: #45a049; }
  </style>
</head>
<body>
  <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>

  <label>Ø§Ù„Ø±Ù‚Ù… (ÙŠØ¯ÙˆÙŠ Ø£Ùˆ Ø¨Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§):</label>
  <input type="text" id="numberInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø£Ùˆ Ø§Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯" required>

  <button onclick="startScanner()">ğŸ“· ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù„Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</button>
  <div id="scanner-container"></div>

  <label>Ù…Ù„Ø§Ø­Ø¸Ø©:</label>
  <textarea id="noteInput" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>

  <button onclick="addEntry()">â• Ø¥Ø¶Ø§ÙØ©</button>

  <hr>
  <button class="nav-button" onclick="goToView()">ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>

  <!-- Ù…ÙƒØªØ¨Ø© QuaggaJS -->
  <script src="https://unpkg.com/@ericblade/quagga2@1.2.6/dist/quagga.min.js"></script>

  <script>
    function addEntry() {
      const number = document.getElementById('numberInput').value.trim();
      const note = document.getElementById('noteInput').value.trim();
      const now = new Date();
      const date = now.toLocaleDateString('ar-MA');
      const time = now.toLocaleTimeString('ar-MA');

      if (!number) {
        alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø£Ùˆ Ù…Ø³Ø­Ù‡ Ø¨Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§");
        return;
      }

      const entry = { number, note, date, time };
      let entries = JSON.parse(localStorage.getItem('entries') || '[]');
      entries.push(entry);
      localStorage.setItem('entries', JSON.stringify(entries));

      alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
      document.getElementById('numberInput').value = '';
      document.getElementById('noteInput').value = '';
    }

    function startScanner() {
      const container = document.getElementById('scanner-container');
      container.innerHTML = ''; // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø©

      Quagga.init({
        inputStream: {
          type: "LiveStream",
          target: container,
          constraints: {
            facingMode: "environment"
          }
        },
        decoder: {
          readers: ["code_128_reader", "ean_reader", "ean_8_reader", "upc_reader"]
        }
      }, function (err) {
        if (err) {
          console.error(err);
          alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§");
          return;
        }
        Quagga.start();
      });

      Quagga.onDetected(result => {
        if (result.codeResult && result.codeResult.code) {
          document.getElementById('numberInput').value = result.codeResult.code;
          Quagga.stop();
          container.innerHTML = ''; // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
        }
      });
    }

    function goToView() {
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
